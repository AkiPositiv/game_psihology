<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игра «Кораблекрушение» / Kema halokati o'yini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a192f;
            color: #cdd6f4;
            background-image:
                radial-gradient(circle at 25% 30%, rgba(20, 83, 153, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 75% 70%, rgba(13, 38, 76, 0.4) 0%, transparent 40%);
        }
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .item-card {
            transition: all 0.3s ease;
            border: 2px solid #1e293b;
            cursor: pointer;
        }
        .item-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: #38bdf8;
        }
        .item-card.selected {
            border-color: #67e8f9;
            box-shadow: 0 0 20px rgba(103, 232, 249, 0.5);
            transform: scale(1.05);
        }
        .item-card .overlay {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .item-card.selected .overlay {
            opacity: 1;
        }
        #curtain {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(to top, #0a192f, #112240);
            z-index: 20;
            transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
            transform-origin: bottom;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 5vh;
        }
        #curtain.raised {
            transform: translateY(-100%);
        }
        .fade-in {
            animation: fadeIn 1s ease-in-out forwards;
        }
        .fade-in-fast {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .results-content {
            position: relative;
            z-index: 10;
        }
        .form-input {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn-primary { background-color: #0ea5e9; color: white; }
        .btn-primary:hover:not(:disabled) { background-color: #38bdf8; }
        .btn-secondary { background-color: #334155; color: #94a3b8; }
        .btn-secondary:hover:not(:disabled) { background-color: #475569; }
        .btn:disabled { background-color: #475569; color: #64748b; cursor: not-allowed; opacity: 0.5; }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex items-center justify-center">

    <div id="language-switcher" class="hidden fixed top-4 right-4 z-50">
        <button id="lang-toggle-btn" class="btn btn-secondary px-3 py-2 rounded-md font-semibold text-sm"></button>
    </div>

    <div class="container mx-auto max-w-7xl">
        <!-- Часть -1: Выбор языка -->
        <section id="language-selection">
            <div class="max-w-md mx-auto bg-slate-800/50 backdrop-blur-sm rounded-xl p-8 shadow-2xl border border-slate-700 text-center">
                 <h1 class="text-3xl font-serif text-sky-300 mb-6">Выберите язык / Tilni tanlang</h1>
                 <div class="flex flex-col space-y-4">
                    <button class="btn btn-primary py-3 rounded-md font-bold text-lg" onclick="initGame('ru')">Русский</button>
                    <button class="btn btn-primary py-3 rounded-md font-bold text-lg" onclick="initGame('uz')">O'zbekcha</button>
                 </div>
            </div>
        </section>

        <!-- Часть 0: Настройка команды -->
        <section id="setup-section" class="hidden">
            <div class="max-w-2xl mx-auto bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 sm:p-8 shadow-2xl border border-slate-700">
                <h1 class="text-3xl sm:text-4xl font-serif text-sky-300 mb-2 text-center" data-lang="setupTitle"></h1>
                <p class="text-center text-slate-400 mb-8" data-lang="setupSubtitle"></p>
                <div class="space-y-6">
                    <div>
                        <label for="team-name" class="block text-sm font-medium text-slate-300 mb-2" data-lang="teamNameLabel"></label>
                        <input type="text" id="team-name" class="form-input w-full rounded-md p-2" data-lang-placeholder="teamNamePlaceholder">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2"><span data-lang="participantsLabel"></span> (<span id="participant-count">0</span>/15)</label>
                        <div class="flex gap-2">
                            <input type="text" id="participant-name" class="form-input w-full rounded-md p-2" data-lang-placeholder="participantNamePlaceholder">
                            <button id="add-participant-btn" class="btn btn-secondary px-4 py-2 rounded-md font-semibold" data-lang="addBtn"></button>
                        </div>
                         <p class="text-xs text-slate-500 mt-2" data-lang="participantsRule"></p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-300 mb-2" data-lang="teamListLabel"></h3>
                        <ul id="participants-list" class="bg-slate-900/50 p-3 rounded-md min-h-[80px] space-y-1">
                            <li id="no-participants" class="text-slate-500 italic" data-lang="noParticipants"></li>
                        </ul>
                    </div>
                    <button id="start-game-btn" class="btn btn-primary w-full py-3 rounded-md font-bold text-lg" data-lang="startGameBtn" disabled></button>
                </div>
            </div>
        </section>

        <!-- Основная игра (скрыта по умолчанию) -->
        <div id="game-container" class="hidden">
            <header class="text-center mb-8">
                <h1 class="text-4xl sm:text-6xl font-serif text-sky-300 mb-2 fade-in" data-lang="gameTitle"></h1>
                <p class="text-lg text-slate-400 max-w-3xl mx-auto fade-in" style="animation-delay: 0.2s;" data-lang="gameSubtitle"></p>
            </header>
            <main id="game-section" class="fade-in" style="animation-delay: 0.4s;">
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 sm:p-8 shadow-2xl border border-slate-700 mb-8">
                    <h2 class="text-2xl font-bold text-sky-400 mb-3" data-lang="scenarioTitle"></h2>
                    <p class="text-slate-300 leading-relaxed" data-lang="scenarioText"></p>
                </div>
                <div class="sticky top-4 bg-slate-900/80 backdrop-blur-md p-4 rounded-lg z-10 shadow-lg mb-8 border border-slate-700">
                     <h3 class="text-xl font-bold text-center text-sky-400 mb-2" data-lang="yourChoice"></h3>
                     <div id="selected-items-display" class="flex flex-wrap gap-3 justify-center min-h-[40px]">
                         <p id="selection-placeholder" class="text-slate-500 italic" data-lang="selectItemsPlaceholder"></p>
                     </div>
                </div>
                <div id="items-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 sm:gap-6"></div>
            </main>
            <div id="results-container" class="relative mt-12 overflow-hidden">
                <div class="results-content p-6 sm:p-8 rounded-xl bg-slate-800/50 border border-slate-700">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl sm:text-4xl font-serif text-green-300 mb-2" data-lang="expertsRatingTitle"></h2>
                        <p class="text-slate-400 max-w-2xl mx-auto" data-lang="expertsRatingSubtitle"></p>
                    </div>
                    <div class="space-y-6 mb-12" id="expert-results-list"></div>
                    <div class="border-t border-slate-700 pt-8">
                        <h2 class="text-3xl sm:text-4xl font-serif text-amber-300 mb-6 text-center" data-lang="discussionTitle"></h2>
                        <div id="discussion-questions" class="space-y-4 text-slate-300"></div>
                    </div>
                </div>
                <div id="curtain">
                    <div class="text-center">
                        <button id="submit-button" class="btn btn-primary text-xl font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 cursor-pointer transition-opacity" data-lang="submitBtn" disabled></button>
                        <p id="submit-helper-text" class="mt-4 text-slate-400"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- TRANSLATIONS & DATA ---
        const translations = {
            ru: {
                setupTitle: "Подготовка к Игре",
                setupSubtitle: "Создайте свою команду для приключения.",
                teamNameLabel: "Название команды",
                teamNamePlaceholder: "Например, 'Морские Волки'",
                participantsLabel: "Участники",
                addBtn: "Добавить",
                participantsRule: "Минимум 3 участника для начала игры.",
                teamListLabel: "Список команды:",
                noParticipants: "Здесь появятся имена участников...",
                startGameBtn: "Начать игру",
                gameTitle: "Кораблекрушение",
                gameSubtitle: "Классическое упражнение на групповое принятие решений в стрессовой ситуации.",
                scenarioTitle: "Сценарий",
                scenarioText: "Вы — команда, выжившая после кораблекрушения. Вы оказались на необитаемом острове. У вас есть список из 15 предметов, выброшенных на берег. Ваша спасательная шлюпка может вместить <strong class='text-yellow-300'>только 5 из них</strong>, чтобы отправиться к соседнему, более безопасному острову. Ваша задача — <strong class='text-yellow-300'>за 10 минут</strong> договориться и выбрать 5 самых важных предметов.",
                yourChoice: "Ваш выбор (<span id='selected-count'>0</span>/5)",
                selectItemsPlaceholder: "Выберите предметы из списка ниже...",
                submitBtn: "Отправить",
                submitHelperDefault: "Сделайте выбор из 5 предметов, чтобы продолжить",
                submitHelperSuccess: "Отлично! Теперь можно отправлять результаты.",
                submitHelperMore: "Выберите еще {count} предмет(а).",
                expertsRatingTitle: "Рейтинг Экспертов",
                expertsRatingSubtitle: "Сравните ваш выбор с рейтингом, составленным экспертами по выживанию.",
                yourChoiceChip: "ВАШ ВЫБОР",
                discussionTitle: "Обсуждение и Рефлексия",
                telegramTitle: "Результаты игры \"Кораблекрушение\"",
                telegramTeam: "Команда",
                telegramParticipants: "Участники",
                telegramItems: "Выбранные предметы",
                langToggle: "O'zbekcha",
                alertMaxItems: "Можно выбрать только 5 предметов!"
            },
            uz: {
                setupTitle: "O'yinga tayyorgarlik",
                setupSubtitle: "Sarguzasht uchun o'z jamoangizni yarating.",
                teamNameLabel: "Jamoa nomi",
                teamNamePlaceholder: "Masalan, 'Dengiz Bo'rilari'",
                participantsLabel: "Ishtirokchilar",
                addBtn: "Qo'shish",
                participantsRule: "O'yinni boshlash uchun kamida 3 ishtirokchi kerak.",
                teamListLabel: "Jamoa ro'yxati:",
                noParticipants: "Ishtirokchilarning ismlari shu yerda paydo bo'ladi...",
                startGameBtn: "O'yinni boshlash",
                gameTitle: "Kema halokati",
                gameSubtitle: "Stressli vaziyatda guruh bo'lib qaror qabul qilish uchun klassik mashq.",
                scenarioTitle: "Ssenariy",
                scenarioText: "Siz — kema halokatidan omon qolgan jamoasiz. Siz kimsasiz orolga tushib qoldingiz. Sohilda 15 ta narsa yotibdi. Sizning qutqaruv qayig'ingiz qo'shni, xavfsizroq orolga borish uchun ulardan <strong class='text-yellow-300'>faqat 5 tasini</strong> sig'dira oladi. Sizning vazifangiz — <strong class='text-yellow-300'>10 daqiqa ichida</strong> kelishib, eng muhim 5 ta narsani tanlash.",
                yourChoice: "Sizning tanlovingiz (<span id='selected-count'>0</span>/5)",
                selectItemsPlaceholder: "Quyidagi ro'yxatdan narsalarni tanlang...",
                submitBtn: "Yuborish",
                submitHelperDefault: "Davom etish uchun 5 ta narsani tanlang",
                submitHelperSuccess: "Ajoyib! Endi natijalarni yuborish mumkin.",
                submitHelperMore: "Yana {count} ta narsa tanlang.",
                expertsRatingTitle: "Mutaxassislar reytingi",
                expertsRatingSubtitle: "O'z tanlovingizni omon qolish bo'yicha mutaxassislar tomonidan tuzilgan reyting bilan solishtiring.",
                yourChoiceChip: "SIZNING TANLOVINGIZ",
                discussionTitle: "Muhokama va Tahlil",
                telegramTitle: "\"Kema halokati\" o'yini natijalari",
                telegramTeam: "Jamoa",
                telegramParticipants: "Ishtirokchilar",
                telegramItems: "Tanlangan narsalar",
                langToggle: "Русский",
                alertMaxItems: "Faqat 5 ta narsa tanlash mumkin!"
            }
        };

        const svgIcons = {
            water: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 2H10.5C8.01472 2 6 4.01472 6 6.5V17.5C6 19.9853 8.01472 22 10.5 22H13.5C15.9853 22 18 19.9853 18 17.5V6.5C18 4.01472 15.9853 2 13.5 2Z"></path><path d="M9 12H15"></path><path d="M12 9V15"></path></svg>`,
            matches: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3H8C6.34315 3 5 4.34315 5 6V18C5 19.6569 6.34315 21 8 21H16C17.6569 21 19 19.6569 19 18V6C19 4.34315 17.6569 3 16 3Z"></path><path d="M12 16V10"></path><path d="M9 7H15"></path></svg>`,
            map: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18L15 15.5L21 18V3L15 5.5L9 3L3 5.5V21L9 18Z"></path><path d="M15 5.5V15.5"></path><path d="M9 3V18"></path></svg>`,
            firstAid: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6H4C2.89543 6 2 6.89543 2 8V20C2 21.1046 2.89543 22 4 22H20C21.1046 22 22 21.1046 22 20V8C22 6.89543 21.1046 6 20 6Z"></path><path d="M10 4V2"></path><path d="M14 4V2"></path><path d="M12 12H16"></path><path d="M14 10V14"></path></svg>`,
            axe: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15.464 12.464L10.01 17.919C8.45501 19.474 6.00035 19.474 4.44536 17.919C2.89037 16.364 2.89037 13.9093 4.44536 12.3543L12.354 4.44563C13.909 2.89064 16.3637 2.89064 17.9187 4.44563L18.989 5.51594"></path><path d="M9 9L15 15"></path></svg>`,
            rope: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z"></path><path d="M12 12V22"></path><path d="M7 7C4.23858 7 2 9.23858 2 12C2 14.7614 4.23858 17 7 17"></path><path d="M17 7C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17"></path></svg>`,
            sleepingBag: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10V8C20 5.79086 18.2091 4 16 4H8C5.79086 4 4 5.79086 4 8V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V14"></path><path d="M20 10H8"></path></svg>`,
            fishingNet: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12H22"></path><path d="M12 2V22"></path><path d="M5 5L19 19"></path><path d="M5 19L19 5"></path><path d="M2 2C5 5 5 5 8 8"></path><path d="M22 2C19 5 19 5 16 8"></path><path d="M2 22C5 19 5 19 8 16"></path><path d="M22 22C19 19 19 19 16 16"></path></svg>`,
            mirror: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 3L3 21"></path><path d="M3 3H21V21"></path></svg>`,
            chocolate: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8H6C4.89543 8 4 8.89543 4 10V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V10C20 8.89543 19.1046 8 18 8Z"></path><path d="M8 8V4"></path><path d="M12 8V2"></path><path d="M16 8V5"></path></svg>`,
            laptop: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 14H21V20H3V14Z"></path><path d="M2 14L4 4H20L22 14"></path><path d="M12 2V4"></path><path d="M12 22V20"></path><path d="M5 3L3 1"></path><path d="M19 3L21 1"></path></svg>`,
            book: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path><path d="M12 10.5c-1.66 0-3 1.12-3 2.5s1.34 2.5 3 2.5 3-1.12 3-2.5-1.34-2.5-3-2.5z"></path></svg>`,
            knife: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20L12 10"></path><path d="M20.5 3.5C21.3284 4.32843 21.3284 5.67157 20.5 6.5L14 13L11 10L17.5 3.5C18.3284 2.67157 19.6716 2.67157 20.5 3.5Z"></path></svg>`,
            pistol: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 3L16 8"></path><path d="M18 6L14 10"></path><path d="M16 12H8V21H16V12Z"></path><path d="M8 12L3 7V3H7L12 8"></path></svg>`,
            raft: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M8 12H16"></path><path d="M12 8V16"></path><path d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z"></path></svg>`
        };
        
        const itemsData = [
            { id: 9, svg: svgIcons.mirror, expertRank: 1, ru: { name: 'Сигнальное зеркало', explanation: 'Главная цель — быть спасенным. Зеркало — самый эффективный способ привлечь внимание спасателей.' }, uz: { name: 'Signal oynasi', explanation: 'Asosiy maqsad — qutqarilish. Oyna qutqaruvchilar e\'tiborini jalb qilishning eng samarali usuli.' } },
            { id: 1, svg: svgIcons.water, expertRank: 2, ru: { name: 'Канистра с водой', explanation: 'Без воды человек может прожить всего несколько дней. Это критически важный ресурс.' }, uz: { name: 'Suv idishi', explanation: 'Suvsiz inson bir necha kun yashay oladi. Bu juda muhim manba.' } },
            { id: 2, svg: svgIcons.matches, expertRank: 3, ru: { name: 'Коробок спичек', explanation: 'Огонь — это тепло, возможность вскипятить воду, приготовить пищу и подать сигнал ночью.' }, uz: { name: 'Gugurt qutisi', explanation: 'Olov — bu issiqlik, suvni qaynatish, ovqat pishirish va tunda signal berish imkoniyati.' } },
            { id: 13, svg: svgIcons.knife, expertRank: 4, ru: { name: 'Нож', explanation: 'Универсальный инструмент: поможет в строительстве укрытия, добыче пищи, защите.' }, uz: { name: 'Pichoq', explanation: 'Universal asbob: boshpana qurish, oziq-ovqat topish, himoyalanishga yordam beradi.' } },
            { id: 3, svg: svgIcons.map, expertRank: 5, ru: { name: 'Карта острова', explanation: 'Поможет найти источники пресной воды, безопасные места и спланировать маршрут.' }, uz: { name: 'Orol xaritasi', explanation: 'Chuchuk suv manbalarini, xavfsiz joylarni topishga va marshrutni rejalashtirishga yordam beradi.' } },
            { id: 4, svg: svgIcons.firstAid, expertRank: 6, ru: { name: 'Аптечка', explanation: 'Важна для оказания первой помощи, но другие предметы имеют более высокий приоритет.' }, uz: { name: 'Aptechka', explanation: 'Birinchi yordam ko\'rsatish uchun muhim, ammo boshqa narsalar ustuvorroq.' } },
            { id: 5, svg: svgIcons.axe, expertRank: 7, ru: { name: 'Топор', explanation: 'Полезный инструмент для строительства, но менее универсален, чем нож.' }, uz: { name: 'Bolta', explanation: 'Qurilish uchun foydali asbob, lekin pichoq kabi universal emas.' } },
            { id: 6, svg: svgIcons.rope, expertRank: 8, ru: { name: 'Веревка', explanation: 'Многоцелевой предмет, полезный для строительства укрытия и создания инструментов.' }, uz: { name: 'Arqon', explanation: 'Ko\'p maqsadli buyum, boshpana qurish va asboblar yasash uchun foydali.' } },
            { id: 8, svg: svgIcons.fishingNet, expertRank: 9, ru: { name: 'Рыболовная сеть', explanation: 'Хороший источник пищи, но требует времени и удачи.' }, uz: { name: 'Baliq ovlash to\'ri', explanation: 'Yaxshi oziq-ovqat manbai, ammo vaqt va omad talab qiladi.' } },
            { id: 12, svg: svgIcons.book, expertRank: 10, ru: { name: 'Книга о растениях', explanation: 'Полезна для поиска съедобных растений, но требует времени.' }, uz: { name: 'O\'simliklar haqida kitob', explanation: 'Iste\'mol qilish mumkin bo\'lgan o\'simliklarni topish uchun foydali, ammo vaqt talab etadi.' } },
            { id: 7, svg: svgIcons.sleepingBag, expertRank: 11, ru: { name: 'Спальный мешок', explanation: 'Обеспечивает комфорт, но укрытие можно построить из подручных материалов.' }, uz: { name: 'Uyqu qopi', explanation: 'Qulaylikni ta\'minlaydi, ammo boshpanani mavjud materiallardan qurish mumkin.' } },
            { id: 10, svg: svgIcons.chocolate, expertRank: 12, ru: { name: 'Шоколад', explanation: 'Быстрый источник энергии, но его мало, и он не является долгосрочным решением.' }, uz: { name: 'Shokolad', explanation: 'Tez energiya manbai, lekin u kam va uzoq muddatli yechim emas.' } },
            { id: 14, svg: svgIcons.pistol, expertRank: 13, ru: { name: 'Пистолет', explanation: 'Может быть использован для самозащиты или охоты, но очень громкий.' }, uz: { name: 'To\'pponcha', explanation: 'O\'zini himoya qilish yoki ov qilish uchun ishlatilishi mumkin, ammo juda shovqinli.' } },
            { id: 15, svg: svgIcons.raft, expertRank: 14, ru: { name: 'Надувной плот', explanation: 'Ненадежное средство для перемещения по открытой воде, легко повредить.' }, uz: { name: 'Puflanadigan sol', explanation: 'Ochiq suvda harakatlanish uchun ishonchsiz vosita, oson shikastlanadi.' } },
            { id: 11, svg: svgIcons.laptop, expertRank: 15, ru: { name: 'Ноутбук (солн. бат.)', explanation: 'Практически бесполезен в условиях выживания без доступа к сети.' }, uz: { name: 'Noutbuk (quyosh bat.)', explanation: 'Tarmoqqa ulanmasdan omon qolish sharoitida deyarli foydasiz.' } }
        ];

        const discussionQuestionsData = [
            { ru: { q: 'О процессе:', d: 'Как именно вы принимали решение? Голосовали? Пытались убедить друг друга? Может, кто-то один принял решение за всех?' }, uz: { q: 'Jarayon haqida:', d: 'Qarorni qanday qabul qildingiz? Ovoz berdingizmi? Bir-biringizni ishontirishga harakat qildingizmi? Yoki kimdir hamma uchun qaror qabul qildimi?' } },
            { ru: { q: 'О лидерстве:', d: 'Появился ли в группе лидер? Если да, то как он себя проявил? Его назначили или он сам взял на себя эту роль?' }, uz: { q: 'Yetakchilik haqida:', d: 'Guruhda yetakchi paydo bo\'ldimi? Agar ha bo\'lsa, u o\'zini qanday namoyon etdi? Uni tayinlashdimi yoki o\'zi bu rolni oldimi?' } },
            { ru: { q: 'Об аргументах:', d: 'Чьи аргументы были самыми убедительными и почему? Какие предметы вызвали больше всего споров?' }, uz: { q: 'Dalillar haqida:', d: 'Kimning dalillari eng ishonchli bo\'ldi va nima uchun? Qaysi narsalar eng ko\'p bahs-munozaralarga sabab bo\'ldi?' } },
            { ru: { q: 'О невысказанном:', d: 'Были ли у кого-то идеи, которые так и не были услышаны? Почему так произошло, как вы думаете?' }, uz: { q: 'Aytilmagan fikrlar haqida:', d: 'Kimdadir eshitilmagan g\'oyalar bo\'ldimi? Sizningcha, nima uchun bunday bo\'ldi?' } },
            { ru: { q: 'Об эмоциях:', d: 'Что было самым сложным: выбрать первый, самый очевидный предмет, или отказаться от шестого, тоже очень нужного?' }, uz: { q: 'Hissiyotlar haqida:', d: 'Nima eng qiyin bo\'ldi: birinchi, eng aniq narsani tanlashmi yoki oltinchi, juda kerakli bo\'lgan narsadan voz kechishmi?' } }
        ];

        // --- STATE ---
        let currentLanguage = 'ru';
        let teamName = '';
        let participants = [];
        let selectedItems = [];

        // --- SELECTORS ---
        const languageSelection = document.getElementById('language-selection');
        const languageSwitcher = document.getElementById('language-switcher');
        const langToggleBtn = document.getElementById('lang-toggle-btn');
        const setupSection = document.getElementById('setup-section');
        const gameContainer = document.getElementById('game-container');
        const teamNameInput = document.getElementById('team-name');
        const participantNameInput = document.getElementById('participant-name');
        const addParticipantBtn = document.getElementById('add-participant-btn');
        const participantsListEl = document.getElementById('participants-list');
        const participantCountEl = document.getElementById('participant-count');
        const startGameBtn = document.getElementById('start-game-btn');
        const itemsGrid = document.getElementById('items-grid');
        const selectedItemsDisplay = document.getElementById('selected-items-display');
        const curtain = document.getElementById('curtain');
        const submitButton = document.getElementById('submit-button');
        const submitHelperText = document.getElementById('submit-helper-text');
        
        // --- LANGUAGE LOGIC ---
        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            const t = translations[lang];

            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.dataset.lang;
                if (t[key]) el.innerHTML = t[key];
            });
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.dataset.langPlaceholder;
                if (t[key]) el.placeholder = t[key];
            });

            langToggleBtn.textContent = t.langToggle;
            
            renderParticipants();
            renderItems();
            updateSelection();
        }

        function initGame(lang) {
            languageSelection.classList.add('hidden');
            setupSection.classList.remove('hidden');
            languageSwitcher.classList.remove('hidden');
            setLanguage(lang);
        }

        langToggleBtn.addEventListener('click', () => {
            const newLang = currentLanguage === 'ru' ? 'uz' : 'ru';
            setLanguage(newLang);
        });

        // --- SETUP LOGIC ---
        function validateSetup() {
            teamName = teamNameInput.value.trim();
            const isTeamNameValid = teamName.length > 0;
            const areParticipantsValid = participants.length >= 3 && participants.length <= 15;
            startGameBtn.disabled = !(isTeamNameValid && areParticipantsValid);
        }

        function renderParticipants() {
            const t = translations[currentLanguage];
            participantsListEl.innerHTML = '';
            if (participants.length === 0) {
                const li = document.createElement('li');
                li.className = 'text-slate-500 italic';
                li.textContent = t.noParticipants;
                participantsListEl.appendChild(li);
            } else {
                participants.forEach((name, index) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center bg-slate-800 p-2 rounded fade-in-fast';
                    li.textContent = name;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.innerHTML = '&times;';
                    removeBtn.className = 'text-red-400 font-bold text-xl hover:text-red-200 ml-2';
                    removeBtn.onclick = () => {
                        participants.splice(index, 1);
                        renderParticipants();
                    };
                    li.appendChild(removeBtn);
                    participantsListEl.appendChild(li);
                });
            }
            participantCountEl.textContent = participants.length;
            validateSetup();
        }
        
        // --- GAME LOGIC ---
        function renderItems() {
            itemsGrid.innerHTML = '';
            itemsData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card bg-slate-800 rounded-lg overflow-hidden shadow-lg transform hover:-translate-y-1 flex flex-col';
                card.dataset.id = item.id;
                const itemLang = item[currentLanguage];
                
                card.innerHTML = `
                    <div class="relative flex-grow flex items-center justify-center p-4 text-sky-300">
                        <div class="w-20 h-20">${item.svg}</div>
                        <div class="overlay absolute inset-0 bg-sky-500/50 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M20 6 9 17l-5-5"/></svg>
                        </div>
                    </div>
                    <div class="p-3 bg-slate-900/50">
                        <h4 class="font-bold text-center text-slate-200 text-sm">${itemLang.name}</h4>
                    </div>
                `;
                card.addEventListener('click', () => toggleItemSelection(item.id));
                itemsGrid.appendChild(card);
            });
             updateSelection();
        }

        function toggleItemSelection(id) {
            const itemIndex = selectedItems.indexOf(id);
            if (itemIndex > -1) {
                selectedItems.splice(itemIndex, 1);
            } else {
                if (selectedItems.length < 5) {
                    selectedItems.push(id);
                } else {
                    const t = translations[currentLanguage];
                    const message = document.createElement('div');
                    message.textContent = t.alertMaxItems;
                    message.className = 'fixed top-5 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg animate-pulse';
                    document.body.appendChild(message);
                    setTimeout(() => message.remove(), 2000);
                    return;
                }
            }
            updateSelection();
        }
        
        function updateSelection() {
            document.querySelectorAll('.item-card').forEach(card => {
                card.classList.toggle('selected', selectedItems.includes(parseInt(card.dataset.id)));
            });

            const selectedCountEl = document.getElementById('selected-count');
            if(selectedCountEl) selectedCountEl.textContent = selectedItems.length;

            const selectionPlaceholder = document.getElementById('selection-placeholder');
            selectedItemsDisplay.innerHTML = '';
            if (selectedItems.length > 0) {
                if(selectionPlaceholder) selectionPlaceholder.style.display = 'none';
                selectedItems.map(id => itemsData.find(item => item.id === id))
                    .forEach(item => {
                        const chip = document.createElement('div');
                        chip.className = 'bg-sky-600 text-white px-3 py-1 rounded-full text-sm font-semibold';
                        chip.textContent = item[currentLanguage].name;
                        selectedItemsDisplay.appendChild(chip);
                    });
            } else {
                if(selectionPlaceholder) {
                    selectionPlaceholder.style.display = 'block';
                    selectionPlaceholder.textContent = translations[currentLanguage].selectItemsPlaceholder;
                }
            }

            const t = translations[currentLanguage];
            if (selectedItems.length === 5) {
                submitButton.disabled = false;
                submitHelperText.textContent = t.submitHelperSuccess;
            } else {
                submitButton.disabled = true;
                if (selectedItems.length > 0) {
                    submitHelperText.textContent = t.submitHelperMore.replace('{count}', 5 - selectedItems.length);
                } else {
                    submitHelperText.textContent = t.submitHelperDefault;
                }
            }
        }
        
        function renderResults() {
            const expertItems = [...itemsData].sort((a, b) => a.expertRank - b.expertRank);
            const t = translations[currentLanguage];
            const resultsContainer = document.getElementById('expert-results-list');
            resultsContainer.innerHTML = '';

            expertItems.slice(0, 5).forEach(item => {
                const isUserSelected = selectedItems.includes(item.id);
                const itemLang = item[currentLanguage];
                const resultCard = document.createElement('div');
                resultCard.className = `flex items-start space-x-4 p-4 rounded-lg border-2 ${isUserSelected ? 'bg-green-500/20 border-green-400' : 'bg-slate-700/50 border-slate-600'}`;
                
                resultCard.innerHTML = `
                    <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-sky-800 rounded-full text-sky-300 text-2xl font-bold font-serif">
                        ${item.expertRank}
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-100 flex items-center">
                            ${itemLang.name}
                            ${isUserSelected ? `<span class="ml-3 text-xs bg-green-400 text-green-900 font-bold px-2 py-0.5 rounded-full">${t.yourChoiceChip}</span>` : ''}
                        </h3>
                        <p class="text-slate-400">${itemLang.explanation}</p>
                    </div>
                `;
                resultsContainer.appendChild(resultCard);
            });
        }

        function renderDiscussionQuestions() {
            const questionsContainer = document.getElementById('discussion-questions');
            questionsContainer.innerHTML = '';
            discussionQuestionsData.forEach(q => {
                const questionLang = q[currentLanguage];
                const questionEl = document.createElement('div');
                questionEl.innerHTML = `
                    <p><strong class="font-bold text-amber-400">${questionLang.q}</strong> ${questionLang.d}</p>
                `;
                questionsContainer.appendChild(questionEl);
            });
        }

        async function sendResultsToTelegram() {
            const botToken = '1730744154:AAGxL3yNgmoN3LOZvOWdNGu6Wgxt81TacXE';
            const chatId = '-1002786023091';
            const t = translations[currentLanguage];

            const selectedItemsNames = selectedItems.map(id => {
                const item = itemsData.find(i => i.id === id);
                return `- ${item[currentLanguage].name}`;
            }).join('\n');

            const participantsList = participants.map(name => `- ${name}`).join('\n');

            const message = `
*${t.telegramTitle}*
--------------------------------------
*${t.telegramTeam}:* ${teamName}
*${t.telegramParticipants}:*
${participantsList}
--------------------------------------
*${t.telegramItems}:*
${selectedItemsNames}
            `;

            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message.trim(),
                        parse_mode: 'Markdown'
                    })
                });
                const data = await response.json();
                if (!data.ok) console.error('Telegram API Error:', data.description);
            } catch (error) {
                console.error('Failed to send message to Telegram:', error);
            }
        }

        // --- Event Listeners ---
        addParticipantBtn.addEventListener('click', () => {
            const name = participantNameInput.value.trim();
            if (name && participants.length < 15) {
                participants.push(name);
                participantNameInput.value = '';
                renderParticipants();
            }
            participantNameInput.focus();
        });

        participantNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addParticipantBtn.click();
        });

        teamNameInput.addEventListener('input', validateSetup);

        startGameBtn.addEventListener('click', () => {
            setupSection.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            renderItems();
        });

        submitButton.addEventListener('click', () => {
            if(submitButton.disabled) return;
            curtain.classList.add('raised');
            renderResults();
            renderDiscussionQuestions();
            sendResultsToTelegram();
            setTimeout(() => {
                document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
            }, 300);
        });

    </script>
</body>
</html>

